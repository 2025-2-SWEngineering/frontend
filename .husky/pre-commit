#!/bin/sh

# Ensure local binaries are resolvable
export PATH="$PATH:$PWD/node_modules/.bin"

# Run lint-staged for ESLint + Prettier, then TypeScript typecheck
if command -v npx >/dev/null 2>&1; then
  if ! npx lint-staged; then
    echo "lint-staged failed. Trying to auto-fix with eslint --fix and prettier --write..."
    npm run lint:fix || true
    npm run format || true
    echo "Re-running lint-staged after auto-fix..."
    npx lint-staged || exit 1
  fi
else
  npm run format:check || exit 1
  npm run lint || exit 1
fi

npm run typecheck || exit 1

exit 0